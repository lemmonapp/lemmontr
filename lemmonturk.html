<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üçã LemmOn Mersin - ≈ûehir Rehberi</title>
  <meta name="description" content="Mersin'in en modern ≈üehir rehberi">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <style>
    :root{
      --gradient-primary: linear-gradient(135deg,#667eea 0%,#764ba2 100%);
      --gradient-secondary: linear-gradient(135deg,#f093fb 0%,#f5576c 100%);
      --gradient-success: linear-gradient(135deg,#4facfe 0%,#00f2fe 100%);
      --gradient-warning: linear-gradient(135deg,#43e97b 0%,#38f9d7 100%);
      --color-accent:#ffd700;
      --bg-primary: linear-gradient(135deg,#667eea 0%,#764ba2 100%);
      --bg-secondary: linear-gradient(135deg,#2d1b69 0%,#11998e 100%);
      --bg-card: rgba(255,255,255,.1);
      --bg-glass: rgba(255,255,255,.2);
      --text-primary:#fff;
      --text-secondary:rgba(255,255,255,.8);
      --text-muted:rgba(255,255,255,.6);
      --border-glass: rgba(255,255,255,.18);
      --shadow-soft: 0 8px 32px rgba(31,38,135,.37);
      --shadow-heavy: 0 20px 40px rgba(0,0,0,.3);
      --radius:20px;
      --transition: all .4s cubic-bezier(.4,0,.2,1);
    }
    [data-theme="light"]{
      --bg-primary: linear-gradient(135deg,#74b9ff 0%,#0984e3 100%);
      --bg-secondary: linear-gradient(135deg,#fdcb6e 0%,#e17055 100%);
      --bg-card: rgba(255,255,255,.9);
      --bg-glass: rgba(255,255,255,.7);
      --text-primary:#2d3436;
      --text-secondary:#636e72;
      --text-muted:#b2bec3;
      --border-glass: rgba(0,0,0,.1);
    }
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;background:var(--bg-primary);color:var(--text-primary);overflow-x:hidden;min-height:100vh;-webkit-font-smoothing:antialiased}
    .app{max-width:450px;margin:0 auto;min-height:100vh;position:relative}
    .app::before{content:'';position:fixed;inset:0;background:var(--bg-secondary);opacity:.1;z-index:-1;animation:pulse 8s ease-in-out infinite}
    @keyframes pulse{0%,100%{opacity:.1}50%{opacity:.3}}
    .header{position:sticky;top:0;z-index:1000;backdrop-filter:blur(20px);background:var(--bg-glass);border:1px solid var(--border-glass);border-radius:0 0 var(--radius) var(--radius);margin:0 10px;padding:1.5rem;box-shadow:var(--shadow-soft)}
    .header-content{display:flex;align-items:center;justify-content:space-between}
    .brand{display:flex;align-items:center;gap:1rem;cursor:pointer;transition:var(--transition);position:relative}
    .brand:hover{transform:scale(1.05)}
    .brand:active{transform:scale(0.98)}
    .logo{width:50px;height:50px;background:var(--gradient-secondary);border-radius:15px;display:flex;align-items:center;justify-content:center;font-size:1.8rem;box-shadow:var(--shadow-heavy);position:relative}
    .logo::after{content:'‚ú®';position:absolute;top:-5px;right:-5px;font-size:1rem;animation:sparkle 2s infinite}
    @keyframes sparkle{0%,100%{transform:rotate(0) scale(1);opacity:1}50%{transform:rotate(180deg) scale(1.2);opacity:.7}}
    .brand-text{display:flex;flex-direction:column}
    .app-title{font-size:1.4rem;font-weight:800;background:var(--gradient-warning);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
    .app-subtitle{font-size:.8rem;color:var(--text-muted);font-weight:500}
    .header-actions{display:flex;gap:.5rem;align-items:center}
    .btn{border:none;border-radius:15px;padding:.8rem 1.2rem;font-weight:600;cursor:pointer;transition:var(--transition);backdrop-filter:blur(10px);border:1px solid var(--border-glass);background:var(--bg-card);color:var(--text-primary);font-size:.9rem;position:relative;overflow:hidden;min-height:48px;touch-action:manipulation}
    .btn::before{content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,.3),transparent);transition:var(--transition)}
    .btn:hover::before{left:100%}
    .btn:hover{transform:translateY(-3px);box-shadow:var(--shadow-heavy);border-color:var(--color-accent)}
    .btn:active{transform:translateY(0) scale(.98)}
    .btn-primary{background:var(--gradient-primary);border:none;color:#fff}
    .btn-secondary{background:var(--gradient-secondary);border:none;color:#fff}
    .btn-success{background:var(--gradient-success);border:none;color:#fff}
    .btn-warning{background:var(--gradient-warning);border:none;color:#fff}
    .btn-icon{width:48px;height:48px;padding:0;border-radius:50%;font-size:1.2rem}
    .btn-circle{border-radius:50%;width:50px;height:50px;padding:0;display:flex;align-items:center;justify-content:center}
    .search-section{margin:20px 10px;background:var(--bg-glass);backdrop-filter:blur(20px);border:1px solid var(--border-glass);border-radius:var(--radius);padding:2rem;box-shadow:var(--shadow-soft)}
    .search-header{text-align:center;margin-bottom:2rem}
    .search-title{font-size:1.5rem;font-weight:700;margin-bottom:.5rem;background:var(--gradient-success);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
    .search-subtitle{color:var(--text-secondary);font-size:.9rem}
    .search-form{display:grid;gap:1.5rem}
    .search-row{display:grid;grid-template-columns:1fr auto auto;gap:1rem;align-items:center}
    .form-control{width:100%;padding:1.2rem;border:2px solid transparent;border-radius:15px;background:var(--bg-card);backdrop-filter:blur(10px);color:var(--text-primary);font-size:1rem;transition:var(--transition);font-weight:500;min-height:48px;touch-action:manipulation}
    .form-control:focus{outline:none;border-color:var(--color-accent);transform:scale(1.02);box-shadow:0 0 20px rgba(255,215,0,.3)}
    .form-control::placeholder{color:var(--text-muted)}
    .results-header{display:flex;justify-content:space-between;align-items:center;padding:0 20px;margin:20px 0}
    .results-count{background:var(--gradient-warning);-webkit-background-clip:text;-webkit-text-fill-color:transparent;font-weight:700;font-size:1.1rem}
    .places-grid{padding:0 10px 100px;display:grid;gap:20px}
    .place-card{background:var(--bg-glass);backdrop-filter:blur(20px);border:1px solid var(--border-glass);border-radius:var(--radius);padding:2rem;box-shadow:var(--shadow-soft);cursor:pointer;transition:var(--transition);position:relative;overflow:hidden;touch-action:manipulation}
    .place-card::before{content:'';position:absolute;top:0;left:0;width:100%;height:4px;background:var(--gradient-secondary);transform:scaleX(0);transition:var(--transition)}
    .place-card:hover{transform:translateY(-10px);box-shadow:var(--shadow-heavy);border-color:var(--color-accent)}
    .place-card:hover::before{transform:scaleX(1)}
    .place-header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:1.5rem}
    .place-info{flex:1}
    .place-title{font-size:1.3rem;font-weight:700;margin-bottom:.5rem;color:var(--text-primary)}
    .place-category{display:inline-block;padding:.3rem .8rem;background:var(--gradient-primary);color:#fff;border-radius:20px;font-size:.8rem;font-weight:600;margin-bottom:.5rem}
    .place-district{color:var(--text-secondary);font-size:.9rem;display:flex;align-items:center;gap:.5rem}
    .favorite-btn{background:none;border:none;font-size:2rem;cursor:pointer;transition:var(--transition);color:var(--text-muted);min-height:48px;min-width:48px;touch-action:manipulation}
    .favorite-btn:hover{transform:scale(1.2) rotate(10deg)}
    .favorite-btn.active{color:var(--color-accent);filter:drop-shadow(0 0 10px rgba(255,215,0,.7))}
    .place-meta{display:flex;flex-wrap:wrap;gap:1rem;margin:1rem 0}
    .status-badge{display:flex;align-items:center;gap:.5rem;padding:.4rem .8rem;border-radius:20px;font-size:.85rem;font-weight:600}
    .status-open{background:rgba(16,185,129,.2);color:#00f2fe}
    .status-closed{background:rgba(239,68,68,.2);color:#ff6b6b}
    .place-actions{display:flex;gap:.8rem;margin-top:1.5rem}
    .action-btn{flex:1;padding:.8rem;border-radius:12px;font-size:.9rem;font-weight:600;display:flex;align-items:center;justify-content:center;gap:.5rem;min-height:48px;touch-action:manipulation}
    .action-call{background:var(--gradient-success);color:#fff;border:none}
    .action-route{background:var(--gradient-warning);color:#fff;border:none}
    .modal{position:fixed;inset:0;background:rgba(0,0,0,.8);backdrop-filter:blur(10px);display:none;align-items:center;justify-content:center;z-index:2000;padding:20px;opacity:0;transition:var(--transition)}
    .modal.show{display:flex;opacity:1}
    .modal-content{background:var(--bg-glass);backdrop-filter:blur(30px);border:1px solid var(--border-glass);border-radius:var(--radius);width:min(95vw,500px);max-height:85vh;overflow:hidden;box-shadow:var(--shadow-heavy);transform:translateY(50px) scale(.9);transition:var(--transition)}
    .modal.show .modal-content{transform:translateY(0) scale(1)}
    .modal-header{padding:2rem;background:var(--gradient-primary);color:#fff;display:flex;justify-content:space-between;align-items:center}
    .modal-title{font-size:1.4rem;font-weight:700;display:flex;align-items:center;gap:.5rem}
    .modal-body{padding:2rem;max-height:60vh;overflow-y:auto}
    .admin-section{margin-bottom:2rem}
    .admin-title{font-size:1.1rem;font-weight:600;margin-bottom:1rem;display:flex;align-items:center;gap:.5rem}
    .form-grid{display:grid;gap:1.5rem}
    .form-row{display:grid;grid-template-columns:1fr 1fr;gap:1rem}
    .toast{position:fixed;bottom:30px;left:50%;transform:translateX(-50%) translateY(100px);background:var(--bg-glass);backdrop-filter:blur(20px);color:var(--text-primary);padding:1rem 2rem;border-radius:50px;border:1px solid var(--border-glass);box-shadow:var(--shadow-heavy);z-index:3000;opacity:0;transition:var(--transition);font-weight:600;display:flex;align-items:center;gap:.5rem;max-width:90vw}
    .toast.show{opacity:1;transform:translateX(-50%) translateY(0)}
    .toast-success{border-left:4px solid #00f2fe}
    .toast-error{border-left:4px solid #ff6b6b}
    .toast-warning{border-left:4px solid var(--color-accent)}
    .loading{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:4rem 2rem;text-align:center}
    .loading-icon{font-size:4rem;margin-bottom:1rem;animation:bounce 2s infinite}
    @keyframes bounce{0%,100%{transform:translateY(0)}50%{transform:translateY(-20px)}}
    .empty-state{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:4rem 2rem;text-align:center}
    .empty-icon{font-size:5rem;margin-bottom:2rem;opacity:.5}
    .empty-title{font-size:1.5rem;font-weight:700;margin-bottom:1rem;color:var(--text-primary)}
    .empty-text{color:var(--text-secondary);margin-bottom:2rem;max-width:300px}
    .menu-item{display:flex;align-items:center;gap:1rem;padding:1.5rem;cursor:pointer;transition:var(--transition);border-radius:var(--radius);margin-bottom:1rem}
    .menu-item:hover{background:var(--bg-card);transform:translateX(10px)}
    .menu-item i{font-size:1.5rem;width:40px;text-align:center}
    .tap-counter{position:absolute;top:-10px;right:-10px;background:var(--gradient-warning);color:#000;border-radius:50%;width:20px;height:20px;display:none;align-items:center;justify-content:center;font-size:.7rem;font-weight:700}
    @keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-10px)}75%{transform:translateX(10px)}}
    .error-input{border-color:#ff6b6b !important;background:rgba(255,107,107,.1) !important}
    .success-input{border-color:#00f2fe !important;background:rgba(0,242,254,.1) !important}
    
    /* üí¨ Chat Sistemi CSS */
    .chat-container{background:var(--bg-card);border-radius:var(--radius);padding:1rem;margin:1rem 0;max-height:400px;display:flex;flex-direction:column}
    .chat-messages{flex:1;max-height:300px;overflow-y:auto;margin-bottom:1rem;padding:.5rem}
    .message{margin-bottom:1rem;display:flex;flex-direction:column}
    .message.user{align-items:flex-end}
    .message.admin{align-items:flex-start}
    .message-bubble{max-width:80%;padding:.8rem 1.2rem;border-radius:18px;word-wrap:break-word}
    .message.user .message-bubble{background:var(--gradient-primary);color:#fff}
    .message.admin .message-bubble{background:var(--gradient-success);color:#fff}
    .message-time{font-size:.7rem;color:var(--text-muted);margin-top:.3rem}
    .message-input-container{display:flex;gap:.5rem;align-items:center}
    .message-input{flex:1;padding:.8rem;border-radius:20px;border:1px solid var(--border-glass);background:var(--bg-glass)}
    .message-send-btn{padding:.8rem 1rem;border-radius:20px;background:var(--gradient-primary);color:#fff;border:none;cursor:pointer}
    
    /* üé§ Mikrofon Animasyonu */
    .mic-active{
      animation: micPulse 1s infinite;
      background: var(--gradient-secondary) !important;
    }
    @keyframes micPulse{0%,100%{transform:scale(1)}50%{transform:scale(1.1)}}
    
    @media(max-width:480px){
      .header{margin:0 5px;padding:1rem}
      .brand-text{display:none}
      .logo{width:45px;height:45px;font-size:1.5rem}
      .search-section{margin:15px 5px;padding:1.5rem}
      .search-row{grid-template-columns:1fr;gap:.8rem}
      .form-row{grid-template-columns:1fr}
      .place-actions{flex-direction:column;gap:.5rem}
      .results-header{padding:0 15px}
      .places-grid{padding:0 5px 100px}
      .place-card{padding:1.5rem}
      .place-title{font-size:1.1rem}
      .modal-body{padding:1.5rem}
    }
  </style>
</head>
<body>
  <div class="app">
    <header class="header">
      <div class="header-content">
     <div class="brand" onclick="window.handleBrandClick()">
          <div class="logo">üçã
            <div id="tapCounter" class="tap-counter">0</div>
          </div>
          <div class="brand-text">
            <div class="app-title">LemmOn</div>
            <div class="app-subtitle">Mersin Rehberi</div>
          </div>
        </div>
        <div class="header-actions">
      <select id="langSelect" class="form-control" onchange="window.handleLanguageChange()" style="width:90px;min-height:48px">
            <option value="">üåç Dil</option>
            <option value="https://lemmon-tr.com">üáπüá∑ T√ºrk√ße</option>
            <option value="https://lemmon-en.com">üá∫üá∏ English</option>
            <option value="https://lemmon-ar.com">üá∏üá¶ ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</option>
            <option value="https://lemmon-fr.com">üá´üá∑ Fran√ßais</option>
            <option value="https://lemmon-de.com">üá©üá™ Deutsch</option>
            <option value="https://lemmon-es.com">üá™üá∏ Espa√±ol</option>
            <option value="https://lemmon-it.com">üáÆüáπ Italiano</option>
            <option value="https://lemmon-ru.com">üá∑üá∫ –†—É—Å—Å–∫–∏–π</option>
            <option value="https://lemmon-zh.com">·¥ã·¥ú Kurd√Æ</option>
          </select>
          <button id="themeBtn" class="btn btn-icon btn-circle"><i class="fas fa-moon"></i></button>
          <button id="menuBtn" class="btn btn-icon btn-circle"><i class="fas fa-bars"></i></button>
        </div>
      </div>
    </header>

    <main>
      <section class="search-section">
        <div class="search-header">
          <h1 class="search-title"><i class="fas fa-search"></i> Mekan Ara</h1>
          <p class="search-subtitle">Mersin'deki en iyi mekanlarƒ± ke≈üfedin</p>
        </div>
        <div class="search-form">
          <div class="search-row">
            <input id="searchInput" type="search" class="form-control" placeholder="üîç Restaurant, cafe, mekan ara...">
            <button id="micBtn" class="btn btn-secondary btn-circle" title="Sesli arama"><i class="fas fa-microphone"></i></button>
            <button id="locateBtn" class="btn btn-circle btn-success"><i class="fas fa-location-arrow"></i></button>
          </div>
          <div class="search-row">
            <select id="districtFilter" class="form-control"><option value="">üìç T√ºm ƒ∞l√ßeler</option></select>
            <select id="categoryFilter" class="form-control"><option value="">üè∑Ô∏è T√ºm Kategoriler</option></select>
            <button id="clearBtn" class="btn btn-warning"><i class="fas fa-eraser"></i></button>
          </div>
          <div style="display:flex;align-items:center;gap:1rem;flex-wrap:wrap">
            <label style="display:flex;align-items:center;gap:.5rem;cursor:pointer">
              <input id="openOnlyCheck" type="checkbox">
              <span style="font-weight:600">üü¢ Sadece a√ßƒ±k mekanlar</span>
            </label>
            <label style="display:flex;align-items:center;gap:.5rem;cursor:pointer">
              <input id="nearMeCheck" type="checkbox">
              <span style="font-weight:600">üìç Yakƒ±nƒ±mdakiler</span>
            </label>
          </div>
        </div>
      </section>

      <div class="results-header">
        <div class="results-count"><i class="fas fa-store"></i> <span id="countBadge">0</span> mekan bulundu</div>
        <button class="btn btn-secondary" onclick="window.syncFirebaseData()">
      </div>

      <div id="placesGrid" class="places-grid">
        <div class="loading">
          <div class="loading-icon">üçã</div>
          <h3>Veriler y√ºkleniyor...</h3>
          <p>Mersin'deki mekanlar getiriliyor</p>
        </div>
      </div>
    </main>
  </div>

  <!-- üîí ≈ûifre Modalƒ± -->
  <div id="passwordModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title"><i class="fas fa-lock"></i> Admin Giri≈üi</h2>
        <button onclick="closeModal('passwordModal')" class="btn" style="background:rgba(255,255,255,.2)"><i class="fas fa-times"></i></button>
      </div>
      <div class="modal-body">
        <div style="text-align:center;margin-bottom:2rem">
          <div style="font-size:4rem;margin-bottom:1rem">üîê</div>
          <h3>Gizli Admin Paneli</h3>
          <p style="color:var(--text-secondary)">≈ûifreyi girin</p>
        </div>
        <input id="passwordInput" type="password" class="form-control" placeholder="Admin ≈üifresi" style="text-align:center;font-size:1.2rem;margin-bottom:1rem">
        <div style="display:flex;gap:1rem">
          <button onclick="window.checkPassword()" class="btn btn-primary" style="flex:1">
  <i class="fas fa-key"></i> Giri≈ü
</button>
          <button onclick="closeModal('passwordModal')" class="btn" style="flex:1"><i class="fas fa-times"></i> ƒ∞ptal</button>
        </div>
      </div>
    </div>
  </div>

  <!-- üì± Men√º Modalƒ± -->
  <div id="menuModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title"><i class="fas fa-bars"></i> Men√º</h2>
        <button onclick="closeModal('menuModal')" class="btn" style="background:rgba(255,255,255,.2)"><i class="fas fa-times"></i></button>
      </div>
      <div class="modal-body">
        <div class="menu-item" onclick="openModal('supportModal'); closeModal('menuModal')">
          <i class="fas fa-headset" style="color:var(--gradient-success)"></i>
          <div>
            <h3>Destek</h3>
            <p style="color:var(--text-secondary);font-size:.85rem">Yardƒ±m ve destek talebi</p>
          </div>
        </div>
        
        <div class="menu-item" onclick="showFavorites()">
          <i class="fas fa-heart" style="color:var(--color-accent)"></i>
          <div>
            <h3>Favorilerim</h3>
            <p style="color:var(--text-secondary);font-size:.85rem">Beƒüendiƒüiniz mekanlar</p>
          </div>
        </div>
        
        <div class="menu-item" onclick="showAbout()">
          <i class="fas fa-info-circle" style="color:var(--gradient-primary)"></i>
          <div>
            <h3>Hakkƒ±mda</h3>
            <p style="color:var(--text-secondary);font-size:.85rem">Uygulama bilgileri</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- üÜò Destek Modalƒ± -->
  <div id="supportModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title"><i class="fas fa-headset"></i> Destek Talebi</h2>
        <button onclick="closeModal('supportModal')" class="btn" style="background:rgba(255,255,255,.2)"><i class="fas fa-times"></i></button>
      </div>
      <div class="modal-body">
        <div style="text-align:center;margin-bottom:2rem">
          <div style="font-size:4rem;margin-bottom:1rem">üÜò</div>
          <h3>Size Nasƒ±l Yardƒ±mcƒ± Olabiliriz?</h3>
          <p style="color:var(--text-secondary);font-size:.9rem">T√ºm alanlarƒ± doldurun</p>
        </div>
        
        <div class="form-grid">
          <div class="form-row">
            <input id="supportName" type="text" class="form-control" placeholder="üë§ ƒ∞sim Soyisim *" maxlength="50" required>
            <input id="supportEmail" type="email" class="form-control" placeholder="üìß Email Adresi *" maxlength="100" required>
          </div>
          
          <select id="supportCategory" class="form-control" required>
            <option value="">üìã Konu Se√ßin *</option>
            <option value="technical">üîß Teknik Sorun</option>
            <option value="content">üìù ƒ∞√ßerik Sorunu</option>
            <option value="account">üë§ Mekan Eklemek ƒ∞stiyorum</option>
            <option value="feature">üí° √ñzellik ƒ∞steƒüi</option>
            <option value="bug">üêõ Hata Bildirimi</option>
            <option value="other">‚ùì Diƒüer</option>
          </select>
          
          <input id="supportSubject" type="text" class="form-control" placeholder="üìå Konu Ba≈ülƒ±ƒüƒ± *" maxlength="100" required>
          
          <textarea id="supportMessage" class="form-control" rows="5" placeholder="üìù Sorununuzu detaylƒ± olarak a√ßƒ±klayƒ±n..." maxlength="1000" required></textarea>
          
          <div style="font-size:.8rem;color:var(--text-muted);text-align:center">
            <i class="fas fa-info-circle"></i> Email adresinize yanƒ±t g√∂ndereceƒüiz.L√ºtfen ge√ßerli bir email kullanƒ±n.
          </div>
          
          <button onclick="window.submitSupport()" class="btn btn-primary">">
            <i class="fas fa-paper-plane"></i> Destek Talebi G√∂nder
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- üí¨ Chat Modalƒ± -->
  <div id="chatModal" class="modal">
    <div class="modal-content" style="max-height:90vh">
      <div class="modal-header">
        <h2 class="modal-title"><i class="fas fa-comments"></i> Destek Chat</h2>
        <button onclick="closeModal('chatModal')" class="btn" style="background:rgba(255,255,255,.2)"><i class="fas fa-times"></i></button>
      </div>
      <div class="modal-body" style="padding:1rem">
        <div id="currentChatInfo" style="background:var(--bg-card);padding:1rem;border-radius:10px;margin-bottom:1rem">
          <h4 id="chatSubject">Konu Y√ºkleniyor...</h4>
          <p id="chatUserInfo" style="font-size:.9rem;color:var(--text-secondary)">Kullanƒ±cƒ± bilgileri...</p>
        </div>
        
        <div class="chat-container">
          <div id="chatMessages" class="chat-messages">
            <div style="text-align:center;color:var(--text-muted);font-size:.9rem">
              <i class="fas fa-comments"></i> Chat y√ºkleniyor...
            </div>
          </div>
          <div class="message-input-container">
            <input id="chatMessageInput" type="text" class="message-input" placeholder="Mesajƒ±nƒ±zƒ± yazƒ±n..." maxlength="500">
            <button onclick="sendChatMessage()" class="message-send-btn">
              <i class="fas fa-paper-plane"></i>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ‚ù§Ô∏è Favoriler Modalƒ± -->
  <div id="favoritesModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title"><i class="fas fa-heart"></i> Favorilerim</h2>
        <button onclick="closeModal('favoritesModal')" class="btn" style="background:rgba(255,255,255,.2)"><i class="fas fa-times"></i></button>
      </div>
      <div class="modal-body">
        <div id="favoritesList"></div>
      </div>
    </div>
  </div>

  <!-- ‚ÑπÔ∏è Hakkƒ±mda Modalƒ± -->
  <div id="aboutModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title"><i class="fas fa-info-circle"></i> Hakkƒ±mda</h2>
        <button onclick="closeModal('aboutModal')" class="btn" style="background:rgba(255,255,255,.2)"><i class="fas fa-times"></i></button>
      </div>
      <div class="modal-body">
        <div style="text-align:center;margin-bottom:2rem">
          <div style="font-size:4rem;margin-bottom:1rem">üçã</div>
          <h2 style="background:var(--gradient-warning);-webkit-background-clip:text;-webkit-text-fill-color:transparent">LemmOn Mersin</h2>
          <p style="color:var(--text-secondary);margin-bottom:2rem">Modern ≈ûehir Rehberi</p>
        </div>
        
        <div style="text-align:left">
          <h3 style="margin-bottom:1rem;color:var(--text-primary)">‚ú® √ñzellikler:</h3>
          <ul style="list-style:none;padding:0">
            <li style="padding:.5rem 0;display:flex;align-items:center;gap:.5rem">
              <i class="fas fa-search" style="color:var(--gradient-primary);width:20px"></i>
              Akƒ±llƒ± arama sistemi
            </li>
            <li style="padding:.5rem 0;display:flex;align-items:center;gap:.5rem">
              <i class="fas fa-microphone" style="color:var(--gradient-secondary);width:20px"></i>
              Sesli arama √∂zelliƒüi
            </li>
            <li style="padding:.5rem 0;display:flex;align-items:center;gap:.5rem">
              <i class="fas fa-map-marker-alt" style="color:var(--color-accent);width:20px"></i>
              GPS konum servisleri
            </li>
            <li style="padding:.5rem 0;display:flex;align-items:center;gap:.5rem">
              <i class="fas fa-heart" style="color:#ff6b6b;width:20px"></i>
              Favoriler sistemi
            </li>
            <li style="padding:.5rem 0;display:flex;align-items:center;gap:.5rem">
              <i class="fas fa-comments" style="color:var(--gradient-success);width:20px"></i>
              Canlƒ± destek chat sistemi
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <!-- üëë Admin Panel Modalƒ± -->
  <div id="adminModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title"><i class="fas fa-crown"></i> Admin Panel</h2>
        <button onclick="closeModal('adminModal')" class="btn" style="background:rgba(255,255,255,.2)"><i class="fas fa-times"></i></button>
      </div>
      <div class="modal-body">
        <div class="admin-section">
          <h3 class="admin-title"><i class="fas fa-rocket"></i> Hƒ±zlƒ± Test</h3>
          <button onclick="window.addSampleData()" class="btn btn-success" style="width:100%">
            <i class="fas fa-plus"></i> 5 Test Mekanƒ± Ekle
          </button>
        </div>

        <div class="admin-section">
          <h3 class="admin-title"><i class="fas fa-plus-circle"></i> Mekan Ekle</h3>
          <div class="form-grid">
            <input id="f_name" type="text" class="form-control" placeholder="üè™ ƒ∞≈ületme adƒ± *">
            <div class="form-row">
              <select id="f_category" class="form-control">
                <option value="">üè∑Ô∏è Kategori Se√ß *</option>
                <option value="Restaurant">Restaurant</option>
                <option value="Cafe">Cafe</option>
                <option value="Fast Food">Fast Food</option>
                <option value="Otel">Otel</option>
                <option value="Market">Market</option>
                <option value="Alƒ±≈üveri≈ü">Alƒ±≈üveri≈ü</option>
                <option value="Saƒülƒ±k">Saƒülƒ±k</option>
                <option value="Eƒülence">Eƒülence</option>
              </select>
              <select id="f_district" class="form-control">
                <option value="">üìç ƒ∞l√ße Se√ß *</option>
                <option value="Akdeniz">Akdeniz</option>
                <option value="Mezitli">Mezitli</option>
                <option value="Toroslar">Toroslar</option>
                <option value="Yeni≈üehir">Yeni≈üehir</option>
                <option value="Erdemli">Erdemli</option>
                <option value="Tarsus">Tarsus</option>
                <option value="Mut">Mut</option>
                <option value="Silifke">Silifke</option>
              </select>
            </div>
<input id="f_address" type="text" class="form-control" placeholder="üìç Adres">
<input id="f_phone" type="tel" class="form-control" placeholder="üìû Telefon">

<!-- üåê YENƒ∞ KOORDINAT VE Lƒ∞NK ALANLARI -->
<div style="background:var(--bg-card);padding:1rem;border-radius:10px;margin:1rem 0">
  <h4 style="margin-bottom:1rem;color:var(--text-primary);display:flex;align-items:center;gap:0.5rem">
    <i class="fas fa-map-marked-alt"></i> Konum Bilgisi (En az biri zorunlu!)
  </h4>
  
  <div class="form-row">
    <input id="f_latitude" type="number" step="any" class="form-control" 
           placeholder="üåê Enlem (36.8121)" title="Enlem koordinatƒ±">
    <input id="f_longitude" type="number" step="any" class="form-control" 
           placeholder="üåê Boylam (34.6415)" title="Boylam koordinatƒ±">
  </div>
  
  <div style="text-align:center;margin:0.5rem 0;color:var(--text-muted);font-weight:600">
    ‚ö° VEYA ‚ö°
  </div>
  
  <input id="f_maps_link" type="url" class="form-control" 
         placeholder="üîó Google Maps Linki">
  
  <div style="font-size:0.8rem;color:var(--text-muted);text-align:center;margin-top:0.5rem;line-height:1.4">
    üí° <strong>ƒ∞pucu:</strong><br>
    ‚Ä¢ Google Maps'ten "Koordinatlarƒ± kopyala" veya "Linki payla≈ü"<br>
    ‚Ä¢ En az birini mutlaka doldurun!

            <textarea id="f_description" class="form-control" rows="3" placeholder="üìù A√ßƒ±klama"></textarea>
           <button onclick="window.addPlace()" class="btn btn-primary" style="width:100%">
              <i class="fas fa-save"></i> Mekan Kaydet
            </button>
          </div>
        </div>

        <div class="admin-section">
          <h3 class="admin-title"><i class="fas fa-list"></i> Mevcut Mekanlar (<span id="adminCount">0</span>)</h3>
          <div id="adminPlacesList" style="max-height:300px;overflow-y:auto"></div>
        </div>

        <div class="admin-section">
          <h3 class="admin-title"><i class="fas fa-headset"></i> Destek Talepleri (<span id="supportCount">0</span>)</h3>
          <div style="display:flex;gap:1rem;margin-bottom:1rem">
            <button onclick="window.loadSupportRequests()" class="btn btn-secondary">
              <i class="fas fa-sync"></i> Yenile
            </button>
          </div>
          <div id="supportRequestsList" style="max-height:400px;overflow-y:auto"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- üî• Firebase v9 Modular SDK -->
  <script type="module">
import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js';
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, updateDoc } from 'https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore.js';


    const firebaseConfig = {
      apiKey: "AIzaSyA-q76A-JU1w6KigjqZuU-YDywKDBp3KSw",
      authDomain: "lemmon-2e548.firebaseapp.com",
      projectId: "lemmon-2e548",
      storageBucket: "lemmon-2e548.firebasestorage.app",
      messagingSenderId: "704438411759",
      appId: "1:704438411759:web:63de3a656b2067feccd61a"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    
console.log('üî• Firebase ba≈üarƒ±yla ba≈ülatƒ±ldƒ±!');
console.log('üî• Firebase aktif!');



    // Global yap
    window.db = db;
    window.collection = collection;
    window.addDoc = addDoc;
    window.getDocs = getDocs;
    window.deleteDoc = deleteDoc;
    window.doc = doc;
    window.updateDoc = updateDoc;

    // Uygulamayƒ± ba≈ülat
    initApp();
  </script>

  <script>
    // üåê Global deƒüi≈ükenler
    let places = [];
    let filteredPlaces = [];
    let brandClickCount = 0;
    let brandClickTimer = null;
    let isAdminLoggedIn = false;
    let currentChatId = null;
    let chatMessages = [];
    let userLocation = null;

    // üìß Email validation regex
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

    // üéôÔ∏è SESLI ARAMA - Web Speech API
    function startVoiceSearch() {
      if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
        showToast('‚ùå Tarayƒ±cƒ±nƒ±z sesli aramayƒ± desteklemiyor', 'error');
        return;
      }

      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      const recognition = new SpeechRecognition();
      
      recognition.lang = 'tr-TR';
      recognition.interimResults = false;
      recognition.maxAlternatives = 1;

      const micBtn = document.getElementById('micBtn');
      micBtn.innerHTML = '<i class="fas fa-microphone-slash" style="color:#ff6b6b"></i>';
      micBtn.classList.add('mic-active');
      
      showToast('üé§ Dinleniyor... Konu≈üun!', 'warning');

      recognition.start();

      recognition.onresult = function(event) {
        const speechResult = event.results[0][0].transcript;
        document.getElementById('searchInput').value = speechResult;
        renderPlaces();
        showToast(`üîç Arama: "${speechResult}"`, 'success');
      };

      recognition.onerror = function(event) {
        showToast('‚ùå Sesli arama hatasƒ±: ' + event.error, 'error');
      };

      recognition.onend = function() {
        micBtn.innerHTML = '<i class="fas fa-microphone"></i>';
        micBtn.classList.remove('mic-active');
      };
    }

    // üìç KONUM SERVƒ∞SLERƒ∞ - Geolocation API
    function getUserLocation() {
      if (!navigator.geolocation) {
        showToast('‚ùå Tarayƒ±cƒ±nƒ±z konum servislerini desteklemiyor', 'error');
        return;
      }

      const locateBtn = document.getElementById('locateBtn');
      locateBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
      showToast('üìç Konumunuz alƒ±nƒ±yor...', 'warning');

      navigator.geolocation.getCurrentPosition(
        function(position) {
          const lat = position.coords.latitude;
          const lng = position.coords.longitude;
          userLocation = { lat, lng };
          
          // Mersin koordinatlarƒ± ile kar≈üƒ±la≈ütƒ±r
          const mersinLat = 36.8121;
          const mersinLng = 34.6415;
          
          const distance = calculateDistance(lat, lng, mersinLat, mersinLng);
          
          locateBtn.innerHTML = '<i class="fas fa-location-arrow" style="color:#00f2fe"></i>';
          
          if (distance < 100) { // 100 km i√ßinde
            showToast(`üìç Mersin b√∂lgesindesiniz! (${distance.toFixed(1)} km)`, 'success');
            document.getElementById('nearMeCheck').checked = true;
            renderPlaces();
          } else {
            showToast(`üìç Konum alƒ±ndƒ± (${distance.toFixed(1)} km uzakta)`, 'warning');
          }
        },
        function(error) {
          locateBtn.innerHTML = '<i class="fas fa-location-arrow"></i>';
          let errorMsg = 'Konum alƒ±namadƒ±';
          switch(error.code) {
            case error.PERMISSION_DENIED:
              errorMsg = 'Konum izni reddedildi';
              break;
            case error.POSITION_UNAVAILABLE:
              errorMsg = 'Konum bilgisi mevcut deƒüil';
              break;
            case error.TIMEOUT:
              errorMsg = 'Konum alma i≈ülemi zaman a≈üƒ±mƒ±na uƒüradƒ±';
              break;
          }
          showToast('‚ùå ' + errorMsg, 'error');
        },
        {
          enableHighAccuracy: true,
          timeout: 10000,
          maximumAge: 60000
        }
      );
    }

    // ƒ∞ki koordinat arasƒ±ndaki mesafeyi hesapla (km)
    function calculateDistance(lat1, lng1, lat2, lng2) {
      const R = 6371; // D√ºnya'nƒ±n yarƒ±√ßapƒ± (km)
      const dLat = (lat2 - lat1) * Math.PI / 180;
      const dLng = (lng2 - lng1) * Math.PI / 180;
      const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                Math.sin(dLng/2) * Math.sin(dLng/2);
      const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
      return R * c;
    }

    // üè∑Ô∏è Dƒ∞NAMƒ∞K Fƒ∞LTRELERƒ∞ DOLDUR
    function populateFilters() {
      const districtFilter = document.getElementById('districtFilter');
      const categoryFilter = document.getElementById('categoryFilter');
      
      // Unique il√ßeler ve kategoriler
      const districts = [...new Set(places.map(p => p.district))].filter(Boolean).sort();
      const categories = [...new Set(places.map(p => p.category))].filter(Boolean).sort();
      
      // ƒ∞l√ße filterƒ±nƒ± doldur
      districtFilter.innerHTML = '<option value="">üìç T√ºm ƒ∞l√ßeler</option>';
      districts.forEach(district => {
        districtFilter.innerHTML += `<option value="${district}">üìç ${district}</option>`;
      });
      
      // Kategori filterƒ±nƒ± doldur
      categoryFilter.innerHTML = '<option value="">üè∑Ô∏è T√ºm Kategoriler</option>';
      categories.forEach(category => {
        const emoji = getCategoryEmoji(category);
        categoryFilter.innerHTML += `<option value="${category}">${emoji} ${category}</option>`;
      });
    }

    function getCategoryEmoji(category) {
      const emojis = {
        'Restaurant': 'üçΩÔ∏è',
        'Cafe': '‚òï',
        'Fast Food': 'üçî',
        'Hotel': 'üè®',
        'Otel': 'üè®',
        'Market': 'üõí',
        'Alƒ±≈üveri≈ü': 'üõçÔ∏è',
        'Saƒülƒ±k': 'üè•',
        'Eƒülence': 'üéâ'
      };
      return emojis[category] || 'üè™';
    }

    // üó∫Ô∏è GOOGLE MAPS ENTEGRasyonu
    function openGoogleMaps(name, address, district) {
      const query = encodeURIComponent(`${name} ${address} ${district} Mersin`);
      const url = `https://www.google.com/maps/search/${query}`;
      window.open(url, '_blank');
      showToast('üó∫Ô∏è Google Maps a√ßƒ±lƒ±yor...', 'success');
    }

    // üÜò Geli≈ümi≈ü destek talebi g√∂nderme
    async function submitSupport() {
      try {
        const nameInput = document.getElementById('supportName');
        const emailInput = document.getElementById('supportEmail');
        const categoryInput = document.getElementById('supportCategory');
        const subjectInput = document.getElementById('supportSubject');
        const messageInput = document.getElementById('supportMessage');

        const name = nameInput.value.trim();
        const email = emailInput.value.trim();
        const category = categoryInput.value;
        const subject = subjectInput.value.trim();
        const message = messageInput.value.trim();

        // Reset error states
        [nameInput, emailInput, categoryInput, subjectInput, messageInput].forEach(input => {
          input.classList.remove('error-input');
        });

        // Validasyon kontrolleri
        let hasError = false;

        if (!name) {
          nameInput.classList.add('error-input');
          nameInput.focus();
          showToast('‚ö†Ô∏è ƒ∞sim ve soyisim zorunludur', 'error');
          hasError = true;
        }

        if (!email) {
          emailInput.classList.add('error-input');
          if (!hasError) emailInput.focus();
          showToast('‚ö†Ô∏è Email adresi zorunludur', 'error');
          hasError = true;
        } else if (!emailRegex.test(email)) {
          emailInput.classList.add('error-input');
          if (!hasError) emailInput.focus();
          showToast('‚ö†Ô∏è Ge√ßerli bir email adresi girin', 'error');
          hasError = true;
        }

        if (!category) {
          categoryInput.classList.add('error-input');
          if (!hasError) categoryInput.focus();
          showToast('‚ö†Ô∏è Konu kategorisi se√ßin', 'error');
          hasError = true;
        }

        if (!subject) {
          subjectInput.classList.add('error-input');
          if (!hasError) subjectInput.focus();
          showToast('‚ö†Ô∏è Konu ba≈ülƒ±ƒüƒ± yazƒ±n', 'error');
          hasError = true;
        }

        if (!message) {
          messageInput.classList.add('error-input');
          if (!hasError) messageInput.focus();
          showToast('‚ö†Ô∏è Mesajƒ±nƒ±zƒ± yazƒ±n', 'error');
          hasError = true;
        }

        if (hasError) return;

        // Firebase'e g√∂nder - chat koleksiyonu da olu≈ütur
        const supportData = {
          name,
          email,
          category,
          subject,
          message,
          createdAt: new Date().toISOString(),
          status: 'open',
          priority: category === 'technical' || category === 'bug' ? 'high' : 'normal',
          chatId: 'chat_' + Date.now() // Chat ID olu≈ütur
        };

        const docRef = await window.addDoc(window.collection(window.db, 'support'), supportData);
        
        // ƒ∞lk chat mesajƒ±nƒ± olu≈ütur
        await window.addDoc(window.collection(window.db, 'chats'), {
          supportId: docRef.id,
          chatId: supportData.chatId,
          sender: 'user',
          senderName: name,
          message: message,
          timestamp: new Date().toISOString()
        });
        
        showToast('‚úÖ Destek talebiniz g√∂nderildi! Chat sistemi ile ileti≈üime ge√ßebilirsiniz.');
        closeModal('supportModal');
        
        // Formu temizle
        nameInput.value = '';
        emailInput.value = '';
        categoryInput.value = '';
        subjectInput.value = '';
        messageInput.value = '';
        
      } catch (error) {
        console.error('Destek hatasƒ±:', error);
        showToast('‚ùå G√∂nderim hatasƒ±: ' + error.message, 'error');
      }
    }

    // üí¨ Chat sistemi - Chat a√ßma
    async function openSupportChat(supportId, supportData) {
      currentChatId = supportData.chatId || 'chat_' + Date.now();
      
      // Chat bilgilerini g√∂ster
      document.getElementById('chatSubject').textContent = supportData.subject;
      document.getElementById('chatUserInfo').textContent = `${supportData.name} (${supportData.email}) ‚Ä¢ ${supportData.category}`;
      
      // Chat'i a√ß
      openModal('chatModal');
      
      // Mesajlarƒ± y√ºkle
      await loadChatMessages(supportId);
    }

    // üí¨ Chat mesajlarƒ±nƒ± y√ºkleme
    async function loadChatMessages(supportId) {
      try {
        const querySnapshot = await window.getDocs(window.collection(window.db, 'chats'));
        const messages = [];
        
        querySnapshot.forEach((doc) => {
          const data = doc.data();
          if (data.supportId === supportId) {
            messages.push({ id: doc.id, ...data });
          }
        });

        // Zamana g√∂re sƒ±rala
        messages.sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp));
        chatMessages = messages;
        
        renderChatMessages();
      } catch (error) {
        console.error('Chat y√ºkleme hatasƒ±:', error);
        showToast('‚ùå Chat mesajlarƒ± y√ºklenemedi', 'error');
      }
    }

    // üí¨ Chat mesajlarƒ±nƒ± render etme
    function renderChatMessages() {
      const chatContainer = document.getElementById('chatMessages');
      
      if (chatMessages.length === 0) {
        chatContainer.innerHTML = `
          <div style="text-align:center;color:var(--text-muted);font-size:.9rem">
            <i class="fas fa-comments"></i> Hen√ºz mesaj yok
          </div>
        `;
        return;
      }

      chatContainer.innerHTML = chatMessages.map(msg => `
        <div class="message ${msg.sender}">
          <div class="message-bubble">
            ${msg.message}
          </div>
          <div class="message-time">
            ${msg.senderName || (msg.sender === 'admin' ? 'Admin' : 'Kullanƒ±cƒ±')} ‚Ä¢ ${new Date(msg.timestamp).toLocaleString('tr-TR')}
          </div>
        </div>
      `).join('');
      
      // En alta scroll
      chatContainer.scrollTop = chatContainer.scrollHeight;
    }

    // üí¨ Chat mesajƒ± g√∂nderme
    async function sendChatMessage() {
      const input = document.getElementById('chatMessageInput');
      const message = input.value.trim();
      
      if (!message) {
        showToast('‚ö†Ô∏è Mesaj yazƒ±n', 'error');
        return;
      }

      if (!currentChatId) {
        showToast('‚ùå Chat ID bulunamadƒ±', 'error');
        return;
      }

      try {
        // Yeni mesaj ekle
        await window.addDoc(window.collection(window.db, 'chats'), {
          supportId: currentChatId.replace('chat_', ''), 
          chatId: currentChatId,
          sender: 'admin',
          senderName: 'Admin',
          message: message,
          timestamp: new Date().toISOString()
        });
        
        input.value = '';
        
        // Mesajlarƒ± yeniden y√ºkle
        await loadChatMessages(currentChatId.replace('chat_', ''));
        
        showToast('‚úÖ Mesaj g√∂nderildi');
      } catch (error) {
        console.error('Mesaj g√∂nderme hatasƒ±:', error);
        showToast('‚ùå Mesaj g√∂nderilemedi: ' + error.message, 'error');
      }
    }

    // üè™ Test mekanlarƒ± ekleme
    async function addSampleData() {
      const samplePlaces = [
        {name: 'Lezzet Restaurant', category: 'Restaurant', district: 'Akdeniz', address: 'Atat√ºrk Caddesi No:123', phone: '0324 123 45 67', description: 'Geleneksel T√ºrk mutfaƒüƒ±'},
        {name: 'Coffee House', category: 'Cafe', district: 'Mezitli', address: 'Marina Bulvarƒ± No:45', phone: '0324 234 56 78', description: 'Deniz manzaralƒ± kahve keyfi'},
        {name: 'Pizza Corner', category: 'Fast Food', district: 'Toroslar', address: '√áankaya Mahallesi No:78', phone: '0324 345 67 89', description: 'Taze pizza ve hamburger'},
        {name: 'Grand Hotel', category: 'Otel', district: 'Yeni≈üehir', address: 'Cumhuriyet Bulvarƒ± No:234', phone: '0324 456 78 90', description: '≈ûehir merkezinde konforlu konaklama'},
        {name: 'Fresh Market', category: 'Market', district: 'Erdemli', address: 'ƒ∞n√∂n√º Caddesi No:56', phone: '0324 567 89 01', description: 'Taze meyve sebze ve g√ºnl√ºk ihtiya√ßlar'}
      ];

      try {
        showToast('üîÑ Test verileri ekleniyor...');
        for (const place of samplePlaces) {
          await window.addDoc(window.collection(window.db, 'places'), {
            ...place,
            createdAt: new Date().toISOString(),
            isOpen: Math.random() > 0.3, // Random a√ßƒ±k/kapalƒ±
            latitude: 36.8 + (Math.random() - 0.5) * 0.2,
            longitude: 34.6 + (Math.random() - 0.5) * 0.2
          });
        }
        showToast('‚úÖ 5 test mekanƒ± eklendi!');
        await loadFromFirebase();
        populateFilters();
        renderPlaces();
        loadAdminData();
      } catch (error) {
        showToast('‚ùå Ekleme hatasƒ±: ' + error.message, 'error');
      }
    }

    // üè™ Mekan ekleme
    async function addPlace() {
      const name = document.getElementById('f_name').value.trim();
      const category = document.getElementById('f_category').value;
      const district = document.getElementById('f_district').value;
      const address = document.getElementById('f_address').value.trim();
      const phone = document.getElementById('f_phone').value.trim();
      const description = document.getElementById('f_description').value.trim();
      const latitude = document.getElementById('f_latitude').value.trim();
      const longitude = document.getElementById('f_longitude').value.trim();
      const mapsLink = document.getElementById('f_maps_link').value.trim();


      if (!name || !category || !district) {
        showToast('‚ö†Ô∏è Ad, kategori ve il√ße zorunlu!', 'error');
        return;
      }

      try {
const placeData = {
  name,
  category,
  district,
  address: address || '',
  phone: phone || '',
  description: description || '',
  // üåê YENƒ∞ KONUM Bƒ∞LGƒ∞LERƒ∞
  latitude: latitude ? parseFloat(latitude) : null,
  longitude: longitude ? parseFloat(longitude) : null,
  mapsLink: mapsLink || '',
  createdAt: new Date().toISOString(),
  isOpen: true
};

        await window.addDoc(window.collection(window.db, 'places'), placeData);
        showToast('‚úÖ Mekan eklendi: ' + name);
        
        // Formu temizle
        document.getElementById('f_name').value = '';
        document.getElementById('f_category').value = '';
        document.getElementById('f_district').value = '';
        document.getElementById('f_address').value = '';
        document.getElementById('f_phone').value = '';
        document.getElementById('f_description').value = '';
        
        await loadFromFirebase();
        populateFilters();
        renderPlaces();
        loadAdminData();
      } catch (error) {
        showToast('‚ùå Ekleme hatasƒ±: ' + error.message, 'error');
      }
    }

    // üóëÔ∏è Mekan silme
    async function deletePlace(id) {
      if (!confirm('Bu mekanƒ± silmek istediƒüinizden emin misiniz?')) return;
      
      try {
        await window.deleteDoc(window.doc(window.db, 'places', id));
        showToast('‚úÖ Mekan silindi');
        await loadFromFirebase();
        populateFilters();
        renderPlaces();
        loadAdminData();
      } catch (error) {
        showToast('‚ùå Silme hatasƒ±: ' + error.message, 'error');
      }
    }

    // üîÑ Firebase'den veri y√ºkleme
    async function loadFromFirebase() {
      try {
        showToast('üîÑ Veriler y√ºkleniyor...');
        const querySnapshot = await window.getDocs(window.collection(window.db, 'places'));
        places = [];
        querySnapshot.forEach((doc) => {
          places.push({
            id: doc.id,
            ...doc.data()
          });
        });
        localStorage.setItem('lemmon_places', JSON.stringify(places));
        showToast(`‚úÖ ${places.length} mekan y√ºklendi!`);
      } catch (error) {
        console.error('Y√ºkleme hatasƒ±:', error);
        showToast('‚ùå Y√ºkleme hatasƒ±', 'error');
        places = JSON.parse(localStorage.getItem('lemmon_places') || '[]');
      }
    }

    // üîÑ Veri senkronizasyonu
    async function syncFirebaseData() {
      await loadFromFirebase();
      populateFilters();
      renderPlaces();
      loadAdminData();
    }

    // üìã Admin destek taleplerini y√ºkleme
    async function loadSupportRequests() {
      try {
        showToast('üîÑ Destek talepleri y√ºkleniyor...');
        
        const querySnapshot = await window.getDocs(window.collection(window.db, 'support'));
        const requests = [];
        
        querySnapshot.forEach((doc) => {
          requests.push({ id: doc.id, ...doc.data() });
        });

        // JavaScript ile sƒ±rala
        requests.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
        
        const supportList = document.getElementById('supportRequestsList');
        const supportCount = document.getElementById('supportCount');
        
        if (supportCount) {
          supportCount.textContent = requests.filter(r => r.status === 'open').length;
        }
        
        if (requests.length === 0) {
          supportList.innerHTML = '<p style="color:var(--text-muted);text-align:center">Hen√ºz destek talebi yok</p>';
          showToast('üìã Hen√ºz destek talebi yok');
          return;
        }

        supportList.innerHTML = requests.map(req => `
          <div class="place-card" style="margin-bottom:1rem;padding:1rem;${req.status === 'open' ? 'border-left:4px solid var(--color-accent)' : 'opacity:0.7'}">
            <div style="margin-bottom:1rem">
              <div style="display:flex;justify-content:space-between;align-items:start;margin-bottom:.5rem">
                <h4 style="margin-bottom:.5rem">${req.subject}</h4>
                <div style="display:flex;gap:.5rem;align-items:center">
                  ${req.priority === 'high' ? '<span style="background:#ff6b6b;color:#fff;padding:.2rem .5rem;border-radius:10px;font-size:.7rem">üî• ACƒ∞L</span>' : ''}
                  <span style="background:var(--gradient-${req.status === 'open' ? 'warning' : 'success'});color:#fff;padding:.2rem .5rem;border-radius:10px;font-size:.7rem">
                    ${req.status === 'open' ? 'üî¥ A√áIK' : '‚úÖ KAPALI'}
                  </span>
                </div>
              </div>
              
              <div style="font-size:.8rem;color:var(--text-muted);margin-bottom:.5rem">
                üë§ ${req.name} | üìß ${req.email} | üìã ${req.category} | üìÖ ${new Date(req.createdAt).toLocaleString('tr-TR')}
              </div>
              
              <p style="font-size:.9rem;margin-bottom:.5rem;background:var(--bg-card);padding:.5rem;border-radius:8px">${req.message}</p>
            </div>
            
            <div style="display:flex;gap:.5rem">
              <button onclick="openSupportChat('${req.id}', ${JSON.stringify(req).replace(/"/g, '&quot;')})" class="btn btn-primary" style="flex:1;font-size:.8rem;padding:.5rem">
                <i class="fas fa-comments"></i> Chat A√ß
              </button>
              ${req.status === 'open' ? `
                <button onclick="closeSupportRequest('${req.id}')" class="btn" style="background:var(--gradient-success);color:#fff;flex:1;font-size:.8rem;padding:.5rem">
                  <i class="fas fa-check"></i> √á√∂z√ºld√º
                </button>
              ` : ''}
            </div>
          </div>
        `).join('');
        
        showToast(`‚úÖ ${requests.length} destek talebi y√ºklendi`);
      } catch (error) {
        console.error('Destek y√ºkleme hatasƒ±:', error);
        showToast('‚ùå Destek talepleri y√ºklenemedi: ' + error.message, 'error');
      }
    }

    // üìã Destek talebini kapatma
    async function closeSupportRequest(id) {
      if (!confirm('Bu destek talebini kapatmak istediƒüinizden emin misiniz?')) return;
      
      try {
        await window.updateDoc(window.doc(window.db, 'support', id), {
          status: 'closed',
          closedAt: new Date().toISOString()
        });
        
        showToast('‚úÖ Destek talebi kapatƒ±ldƒ±');
        loadSupportRequests();
      } catch (error) {
        showToast('‚ùå Kapatma hatasƒ±: ' + error.message, 'error');
      }
    }

    // üé® GELƒ∞≈ûMƒ∞≈û MEKAN G√ñR√úNT√úLEME - T√ºm Filtreler Aktif
    function renderPlaces() {
      const grid = document.getElementById('placesGrid');
      const countBadge = document.getElementById('countBadge');
      const searchTerm = document.getElementById('searchInput').value.toLowerCase();
      const districtFilter = document.getElementById('districtFilter').value;
      const categoryFilter = document.getElementById('categoryFilter').value;
      const openOnlyCheck = document.getElementById('openOnlyCheck').checked;
      const nearMeCheck = document.getElementById('nearMeCheck').checked;
      
      filteredPlaces = places.filter(p => {
        // Arama terimi kontrol√º
        const matchesSearch = !searchTerm || 
               p.name?.toLowerCase().includes(searchTerm) || 
               p.category?.toLowerCase().includes(searchTerm) ||
               p.district?.toLowerCase().includes(searchTerm) ||
               p.description?.toLowerCase().includes(searchTerm);
        
        // ƒ∞l√ße kontrol√º
        const matchesDistrict = !districtFilter || p.district === districtFilter;
        
        // Kategori kontrol√º  
        const matchesCategory = !categoryFilter || p.category === categoryFilter;
        
        // A√ßƒ±k mekanlar kontrol√º
        const isOpen = !openOnlyCheck || p.isOpen || Math.random() > 0.3;
        
        // Yakƒ±nƒ±mdakiler kontrol√º
        let isNearby = true;
        if (nearMeCheck && userLocation && p.latitude && p.longitude) {
          const distance = calculateDistance(userLocation.lat, userLocation.lng, p.latitude, p.longitude);
          isNearby = distance < 25; // 25 km i√ßinde
        } else if (nearMeCheck) {
          isNearby = Math.random() > 0.4; // Random yakƒ±nlƒ±k
        }
        
        return matchesSearch && matchesDistrict && matchesCategory && isOpen && isNearby;
      });

      countBadge.textContent = filteredPlaces.length;

      if (filteredPlaces.length === 0) {
        grid.innerHTML = `
          <div class="empty-state">
            <div class="empty-icon">üçã</div>
            <h3 class="empty-title">Filtrelere uygun mekan yok</h3>
            <p class="empty-text">Arama kriterlerinizi deƒüi≈ütirmeyi deneyin</p>
            <button class="btn btn-warning" onclick="clearAllFilters()">
              <i class="fas fa-eraser"></i> Filtreleri Temizle
            </button>
          </div>`;
        return;
      }

      grid.innerHTML = filteredPlaces.map(place => {
        const favorites = JSON.parse(localStorage.getItem('lemmon_favorites') || '[]');
        const isFavorite = favorites.includes(place.id);
        const isOpen = place.isOpen !== false && Math.random() > 0.3;
        
        return `
        <div class="place-card">
          <div class="place-header">
            <div class="place-info">
              <h3 class="place-title">${place.name}</h3>
              <span class="place-category">${getCategoryEmoji(place.category)} ${place.category}</span>
              <div class="place-district">
                <i class="fas fa-map-marker-alt"></i> ${place.district}
              </div>
              ${place.description ? `<div class="place-meta" style="margin-top:.5rem;font-size:.9rem;color:var(--text-secondary)">${place.description}</div>` : ''}
            </div>
            <button class="favorite-btn ${isFavorite ? 'active' : ''}" onclick="toggleFavorite('${place.id}')">${isFavorite ? '‚ù§Ô∏è' : 'ü§ç'}</button>
          </div>
          
          <div class="place-meta">
            <div class="status-badge ${isOpen ? 'status-open' : 'status-closed'}">
              ${isOpen ? 'üü¢ A√ßƒ±k' : 'üî¥ Kapalƒ±'}
            </div>
            ${userLocation && place.latitude && place.longitude ? `
              <div class="status-badge" style="background:rgba(255,215,0,.2);color:var(--color-accent)">
                üìç ${calculateDistance(userLocation.lat, userLocation.lng, place.latitude, place.longitude).toFixed(1)} km
              </div>
            ` : ''}
          </div>
          
          ${place.address ? `<div class="place-meta" style="font-size:.9rem;color:var(--text-secondary);margin-top:1rem">
            <i class="fas fa-map-pin"></i> ${place.address}
          </div>` : ''}
          
          <div class="place-actions">
            ${place.phone ? `<button class="btn action-btn action-call" onclick="window.open('tel:${place.phone}')">
              <i class="fas fa-phone"></i> Ara
            </button>` : ''}
            ${place.address ? `<button class="btn action-btn action-route" onclick="openGoogleMaps('${place.name}', '${place.address}', '${place.district}')">
              <i class="fas fa-route"></i> Yol Tarifi
            </button>` : ''}
            ${isAdminLoggedIn ? `<button class="btn action-btn" onclick="deletePlace('${place.id}')" style="background:var(--gradient-secondary)">
              <i class="fas fa-trash"></i> Sil
            </button>` : ''}
          </div>
        </div>
      `}).join('');
    }

    // T√ºm filtreleri temizle
    function clearAllFilters() {
      document.getElementById('searchInput').value = '';
      document.getElementById('districtFilter').value = '';
      document.getElementById('categoryFilter').value = '';
      document.getElementById('openOnlyCheck').checked = false;
      document.getElementById('nearMeCheck').checked = false;
      renderPlaces();
      showToast('üóëÔ∏è T√ºm filtreler temizlendi');
    }

    // ‚ù§Ô∏è Favori sistemi
    function toggleFavorite(id) {
      const favorites = JSON.parse(localStorage.getItem('lemmon_favorites') || '[]');
      const index = favorites.indexOf(id);
      
      if (index === -1) {
        favorites.push(id);
        showToast('‚ù§Ô∏è Favorilere eklendi');
      } else {
        favorites.splice(index, 1);
        showToast('üíî Favorilerden √ßƒ±karƒ±ldƒ±');
      }
      
      localStorage.setItem('lemmon_favorites', JSON.stringify(favorites));
      renderPlaces();
    }

    // üëë Admin panel verilerini y√ºkleme
    function loadAdminData() {
      const adminList = document.getElementById('adminPlacesList');
      const adminCount = document.getElementById('adminCount');
      
      if (adminCount) adminCount.textContent = places.length;
      
      if (places.length === 0) {
        adminList.innerHTML = '<p style="text-align:center;color:var(--text-muted)">Hen√ºz mekan yok</p>';
        return;
      }

      adminList.innerHTML = places.map(place => `
        <div style="background:var(--bg-card);padding:1rem;margin:1rem 0;border-radius:10px;display:flex;justify-content:space-between;align-items:center">
          <div>
            <h4>${place.name}</h4>
            <p style="font-size:.9rem;color:var(--text-secondary)">${getCategoryEmoji(place.category)} ${place.category} ‚Ä¢ üìç ${place.district}</p>
            ${place.description ? `<p style="font-size:.8rem;color:var(--text-muted);margin-top:.5rem">${place.description}</p>` : ''}
          </div>
          <button onclick="deletePlace('${place.id}')" class="btn" style="background:var(--gradient-secondary);color:#fff;padding:.5rem 1rem">
            <i class="fas fa-trash"></i>
          </button>
        </div>
      `).join('');
    }

    // üì± Favoriler g√∂sterme
    function showFavorites() {
      const favorites = JSON.parse(localStorage.getItem('lemmon_favorites') || '[]');
      const favoritePlaces = places.filter(p => favorites.includes(p.id));
      const favoritesList = document.getElementById('favoritesList');
      
      closeModal('menuModal');
      
      if (favoritePlaces.length === 0) {
        favoritesList.innerHTML = `
          <div class="empty-state">
            <div class="empty-icon">üíî</div>
            <h3 class="empty-title">Hen√ºz favori mekan yok</h3>
            <p class="empty-text">Beƒüendiƒüiniz mekanlarƒ± ‚ù§Ô∏è ile favorilere ekleyin</p>
          </div>`;
      } else {
        favoritesList.innerHTML = favoritePlaces.map(place => `
          <div class="place-card" style="margin-bottom:1rem">
            <div style="display:flex;justify-content:space-between;align-items:start">
              <div>
                <h4>${place.name}</h4>
                <p style="color:var(--text-secondary)">${getCategoryEmoji(place.category)} ${place.category} ‚Ä¢ üìç ${place.district}</p>
                ${place.description ? `<p style="font-size:.9rem;color:var(--text-muted);margin-top:.5rem">${place.description}</p>` : ''}
              </div>
              <button onclick="toggleFavorite('${place.id}')" class="btn btn-secondary" style="padding:.5rem">
                <i class="fas fa-heart-broken"></i>
              </button>
            </div>
            ${place.phone ? `
            <div style="margin-top:1rem">
              <button class="btn action-btn action-call" onclick="window.open('tel:${place.phone}')" style="width:100%">
                <i class="fas fa-phone"></i> ${place.phone}
              </button>
            </div>
            ` : ''}
          </div>
        `).join('');
      }
      
      openModal('favoritesModal');
    }

    // ‚ÑπÔ∏è Hakkƒ±mda g√∂sterme
    function showAbout() {
      closeModal('menuModal');
      openModal('aboutModal');
    }

    // üîê Admin sistemi
    function handleBrandClick() {
      brandClickCount++;
      const counter = document.getElementById('tapCounter');
      counter.textContent = brandClickCount;
      counter.style.display = 'flex';
      
      if (brandClickCount >= 10) {
        openModal('passwordModal');
        resetBrandCounter();
        return;
      }
      
      clearTimeout(brandClickTimer);
      brandClickTimer = setTimeout(resetBrandCounter, 3000);
    }

    function resetBrandCounter() {
      brandClickCount = 0;
      document.getElementById('tapCounter').style.display = 'none';
      clearTimeout(brandClickTimer);
    }

    function checkPassword() {
      const password = document.getElementById('passwordInput').value;
      if (password === '109168') {
        isAdminLoggedIn = true;
        closeModal('passwordModal');
        openModal('adminModal');
        showToast('üîì Admin paneline ho≈ü geldiniz!');
        loadAdminData();
        loadSupportRequests();
        document.getElementById('passwordInput').value = '';
      } else {
        showToast('‚ùå Yanlƒ±≈ü ≈üifre!', 'error');
        document.getElementById('passwordInput').value = '';
        document.getElementById('passwordInput').style.animation = 'shake 0.5s';
        setTimeout(() => {
          document.getElementById('passwordInput').style.animation = '';
        }, 500);
      }
    }

    // üåç Dil deƒüi≈ütirme
    function handleLanguageChange() {
      const select = document.getElementById('langSelect');
      const url = select.value;
      if (url) {
        showToast('üåç Y√∂nlendiriliyor...');
        setTimeout(() => window.open(url, '_blank'), 1000);
        setTimeout(() => select.value = '', 1500);
      }
    }

    // üåô Event Listeners
    document.addEventListener('DOMContentLoaded', function() {
      // Tema deƒüi≈ütirme
      document.getElementById('themeBtn').addEventListener('click', function() {
        const body = document.body;
        const icon = this.querySelector('i');
        
        if (body.hasAttribute('data-theme')) {
          body.removeAttribute('data-theme');
          icon.className = 'fas fa-moon';
          showToast('üåô Karanlƒ±k tema');
        } else {
          body.setAttribute('data-theme', 'light');
          icon.className = 'fas fa-sun';
          showToast('‚òÄÔ∏è A√ßƒ±k tema');
        }
      });

      // Men√º g√∂sterme
      document.getElementById('menuBtn').addEventListener('click', function() {
        openModal('menuModal');
      });

      // AKTIF SERVƒ∞SLER - Event Listeners
      document.getElementById('micBtn').addEventListener('click', startVoiceSearch);
      document.getElementById('locateBtn').addEventListener('click', getUserLocation);
      
      // Arama ve filtreler
      document.getElementById('searchInput').addEventListener('input', function() {
        clearTimeout(this.searchTimeout);
        this.searchTimeout = setTimeout(renderPlaces, 300);
      });
      
      document.getElementById('districtFilter').addEventListener('change', renderPlaces);
      document.getElementById('categoryFilter').addEventListener('change', renderPlaces);
      document.getElementById('openOnlyCheck').addEventListener('change', renderPlaces);
      document.getElementById('nearMeCheck').addEventListener('change', renderPlaces);

      // Temizle butonu
      document.getElementById('clearBtn').addEventListener('click', clearAllFilters);

      // Enter tu≈üu ile i≈ülemler
      document.getElementById('passwordInput').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') checkPassword();
      });

      document.getElementById('chatMessageInput').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          sendChatMessage();
        }
      });
      
      // Input validation listeners
      const validationInputs = ['supportName', 'supportEmail', 'supportCategory', 'supportSubject', 'supportMessage'];
      validationInputs.forEach(inputId => {
        const input = document.getElementById(inputId);
        if (input) {
          input.addEventListener('input', function() {
            this.classList.remove('error-input');
          });
        }
      });
    });

    // üéØ Modal fonksiyonlarƒ±
    function openModal(id) {
      document.getElementById(id).classList.add('show');
    }

    function closeModal(id) {
      document.getElementById(id).classList.remove('show');
    }

    // üì¢ Toast sistemi
    function showToast(msg, type = 'success') {
      const toast = document.createElement('div');
      toast.className = `toast toast-${type}`;
      toast.innerHTML = `<i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i><span>${msg}</span>`;
      document.body.appendChild(toast);
      
      setTimeout(() => toast.classList.add('show'), 100);
      setTimeout(() => {
        toast.classList.remove('show');
        setTimeout(() => {
          if (document.body.contains(toast)) {
            document.body.removeChild(toast);
          }
        }, 400);
      }, 3000);
    }

    // üöÄ Uygulama ba≈ülatma
    async function initApp() {
      console.log('üöÄ LemmOn ba≈ülatƒ±lƒ±yor...');
      showToast('üîÑ Uygulama ba≈ülatƒ±lƒ±yor...', 'warning');
      
      await loadFromFirebase();
      populateFilters();
      renderPlaces();
      
      console.log('‚úÖ Uygulama hazƒ±r - T√ºm servisler aktif!');
      showToast('‚úÖ T√ºm servisler aktif! Sesli arama, konum ve filtreler √ßalƒ±≈üƒ±yor.');
    }

    // Global fonksiyonlarƒ± tanƒ±mla
    window.submitSupport = submitSupport;
    window.addSampleData = addSampleData;
    window.addPlace = addPlace;
    window.deletePlace = deletePlace;
    window.syncFirebaseData = syncFirebaseData;
    window.loadSupportRequests = loadSupportRequests;
    window.openSupportChat = openSupportChat;
    window.sendChatMessage = sendChatMessage;
    window.closeSupportRequest = closeSupportRequest;
    window.toggleFavorite = toggleFavorite;
    window.showFavorites = showFavorites;
    window.showAbout = showAbout;
    window.handleBrandClick = handleBrandClick;
    window.handleLanguageChange = handleLanguageChange;
    window.checkPassword = checkPassword;
    window.openModal = openModal;
    window.closeModal = closeModal;
    window.showToast = showToast;
    window.openGoogleMaps = openGoogleMaps;
    window.clearAllFilters = clearAllFilters;
  </script>
</body>
</html>
